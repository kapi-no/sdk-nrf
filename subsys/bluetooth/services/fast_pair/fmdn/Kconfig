#
# Copyright (c) 2024 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

menuconfig BT_FAST_PAIR_FMDN
	bool "Find My Device Network extension for Fast Pair [EXPERIMENTAL]"
	select EXPERIMENTAL
	select BT_FAST_PAIR_STORAGE_OWNER_ACCOUNT_KEY
	select BT_FAST_PAIR_FMDN_CRYPTO
	help
	  Enable Find My Device Network (FMDN) extension for Fast Pair.

if BT_FAST_PAIR_FMDN

config BT_FAST_PAIR_FMDN_TX_POWER
	int "TX power set in Bluetooth LE controller [dBm]"
	default 0
	help
	  Define the TX power configuration used for the extension advertising and
	  connections in dBm. The value is passed to the Bluetooth LE controller
	  using a HCI command for all extension transmit activities. The desired TX
	  power configuration may be different from the actual one if a chosen HW
	  platform does not support it. In this case, the FMDN module displays
	  a warning notifying the user about the real TX power during the enabling
	  procedure of this library. The actual TX power value will be as close to
	  the desired configuration as possible.

config BT_FAST_PAIR_FMDN_TX_POWER_CORRECTION_VAL
	int "TX power correction value [dBm]"
	default 0
	help
	  The configured value is added to the TX power readout from Bluetooth
	  LE controller to calculate the calibrated TX power value included in
	  the Read Beacon Parameters response. The correction may be needed to
	  take into acccount hardware configuration (for example, used antenna
	  or device's casing).

	  The calibrated TX power included in the Read Beacon Parameters
	  response has to be in the following dBm range: [-100, 20].

config BT_FAST_PAIR_FMDN_MAX_CONN
	int "Maximum number of FMDN connections"
	default 2
	range 2 BT_MAX_CONN
	help
	  Define the maximum number of connections that can be established using
	  the FMDN advertising payload. The configured pool of the connection
	  slots must always be available to the extension that is in the
	  provisioned state. Other advertising sets than the FMDN advertising
	  set cannot use the connection slots from this pool for their activities.
	  In the typical locator tag use case, the BT_MAX_CONN configuration should
	  be greater than the BT_FAST_PAIR_FMDN_MAX_CONN configuration to provide
	  also connection slots for the standard Fast Pair advertising set.

choice BT_FAST_PAIR_FMDN_ECC_TYPE
	prompt "Elliptic Curve selection"
	default BT_FAST_PAIR_FMDN_ECC_SECP160R1
	help
	  Select the Elliptic Curve used for encryption in FMDN modules.

config BT_FAST_PAIR_FMDN_ECC_SECP160R1
	bool "FMDN with the SECP160R1 Elliptic Curve"
	depends on BT_FAST_PAIR_CRYPTO_SECP160R1_SUPPORT
	help
	  Select the SECP160R1 Elliptic Curve for FMDN. This curve type
	  is less secure than the SECP256R1 variant, but it can be used with
	  Bluetooth Legacy Advertising because of its limited size (160 bits).

config BT_FAST_PAIR_FMDN_ECC_SECP256R1
	bool "FMDN with the SECP256R1 Elliptic Curve"
	depends on BT_FAST_PAIR_CRYPTO_SECP256R1_SUPPORT
	help
	  Select the SECP256R1 Elliptic Curve for FMDN. This curve type
	  is more secure than the SECP160R1 variant but requires using
	  Bluetooth Extended Advertising due to its extended size (256 bits).

endchoice

config BT_FAST_PAIR_FMDN_ECC_LEN
	int
	depends on BT_FAST_PAIR_FMDN_ECC_SECP160R1 || BT_FAST_PAIR_FMDN_ECC_SECP256R1
	default 20 if BT_FAST_PAIR_FMDN_ECC_SECP160R1
	default 32 if BT_FAST_PAIR_FMDN_ECC_SECP256R1
	help
	  Indicate the byte length of the chosen Elliptic Curve type.

config BT_FAST_PAIR_FMDN_CRYPTO
	bool
	depends on BT_FAST_PAIR_CRYPTO_AES256_ECB_SUPPORT
	depends on BT_FAST_PAIR_FMDN_ECC_SECP160R1 || BT_FAST_PAIR_FMDN_ECC_SECP256R1
	help
	  Declare the list of FMDN dependencies on the Fast Pair crypto operations.

config BT_FAST_PAIR_FMDN_RANDOM_NONCE_LEN
	int
	default 8
	help
	  Indicate the byte length of the random nonce used to generate
	  Beacon Actions requests and responses.

config BT_FAST_PAIR_FMDN_AUTH_SEG_LEN
	int
	default 8
	help
	  Indicate the byte length of the authentication segment used
	  to generate the Beacon Actions requests and responses.

choice BT_FAST_PAIR_FMDN_RING_COMP
	prompt "Ringing component selection"
	default BT_FAST_PAIR_FMDN_RING_COMP_NONE
	help
	  Select the number of components capable of ringing.

config BT_FAST_PAIR_FMDN_RING_COMP_NONE
	bool "No component capable of ringing"

config BT_FAST_PAIR_FMDN_RING_COMP_ONE
	bool "Single component capable of ringing"

config BT_FAST_PAIR_FMDN_RING_COMP_TWO
	bool "Two components (left and right buds) capable of ringing"

config BT_FAST_PAIR_FMDN_RING_COMP_THREE
	bool "Three components (left and right buds and case) capable of ringing"

endchoice

config BT_FAST_PAIR_FMDN_RING_VOLUME
	bool "Ringing volume support"
	depends on !BT_FAST_PAIR_FMDN_RING_COMP_NONE
	help
	  Enable this option to indicate ringing volume support.

config BT_FAST_PAIR_FMDN_VERSION_MAJOR
	int
	default 1
	help
	  Major version number of the FMDN protocol.

config BT_FAST_PAIR_FMDN_CALLBACKS
	bool
	default y
	help
	  Add Fast Pair FMDN callbacks source file.

# The FMDN extension requires the system workqueue to execute at
# a cooperative priority.
config SYSTEM_WORKQUEUE_PRIORITY
	range -256 -1

endif # BT_FAST_PAIR_FMDN
